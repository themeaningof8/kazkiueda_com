---
import Layout from '../layouts/Layout.astro';
import Jumbotron from '../components/Jumbotron';
import { getCollection } from 'astro:content';

// 最新の記事とポートフォリオ項目を取得
const articles = await getCollection('articles');
const portfolio = await getCollection('portfolio');

// 最新の3件を取得
const latestArticles = articles
  .filter(article => !article.data.draft)
  .sort(
    (a, b) =>
      new Date(b.data.publishDate).getTime() -
      new Date(a.data.publishDate).getTime()
  )
  .slice(0, 3);

const featuredPortfolio = portfolio
  .filter(item => item.data.featured)
  .sort(
    (a, b) =>
      new Date(b.data.projectDate).getTime() -
      new Date(a.data.projectDate).getTime()
  )
  .slice(0, 3);
---

<Layout title="Kazuki Ueda - Portfolio & Blog">
  <Jumbotron
    client:load
    title="Kazuki Ueda"
    subtitle="フロントエンド開発者として、ユーザー体験を重視したWebアプリケーションの開発を行っています。"
    ctaText="ポートフォリオを見る"
    ctaLink="/portfolio"
  />

  <section class="py-16 bg-background">
    <div class="container mx-auto px-4">
      <div class="grid gap-16 md:grid-cols-2">
        <!-- 最新記事 -->
        <div>
          <h2 class="mb-8 text-3xl font-bold">最新記事</h2>
          <div class="space-y-6">
            {
              latestArticles.map(article => (
                <article class="group cursor-pointer rounded-lg border p-6 hover:shadow-md transition-shadow">
                  <h3 class="mb-2 text-xl font-semibold group-hover:text-primary">
                    <a href={`/articles/${article.slug}`}>
                      {article.data.title}
                    </a>
                  </h3>
                  <p class="mb-3 text-muted-foreground">
                    {article.data.description}
                  </p>
                  <div class="flex items-center gap-2 text-sm text-muted-foreground">
                    <time datetime={article.data.publishDate.toISOString()}>
                      {article.data.publishDate.toLocaleDateString('ja-JP')}
                    </time>
                    <span>•</span>
                    <div class="flex gap-1">
                      {article.data.tags.map(tag => (
                        <span class="rounded-full bg-secondary px-2 py-1 text-xs">
                          #{tag}
                        </span>
                      ))}
                    </div>
                  </div>
                </article>
              ))
            }
          </div>
          <div class="mt-8">
            <a
              href="/articles"
              class="inline-flex items-center text-primary hover:underline"
            >
              すべての記事を見る →
            </a>
          </div>
        </div>

        <!-- フィーチャードポートフォリオ -->
        <div>
          <h2 class="mb-8 text-3xl font-bold">注目のプロジェクト</h2>
          <div class="space-y-6">
            {
              featuredPortfolio.map(project => (
                <article class="group cursor-pointer rounded-lg border p-6 hover:shadow-md transition-shadow">
                  <h3 class="mb-2 text-xl font-semibold group-hover:text-primary">
                    <a href={`/portfolio/${project.slug}`}>
                      {project.data.title}
                    </a>
                  </h3>
                  <p class="mb-3 text-muted-foreground">
                    {project.data.description}
                  </p>
                  <div class="flex flex-wrap gap-2 mb-3">
                    {project.data.technologies.map(tech => (
                      <span class="rounded-full bg-primary/10 px-2 py-1 text-xs text-primary">
                        {tech}
                      </span>
                    ))}
                  </div>
                  <div class="flex items-center gap-4 text-sm text-muted-foreground">
                    <time datetime={project.data.projectDate.toISOString()}>
                      {project.data.projectDate.toLocaleDateString('ja-JP')}
                    </time>
                    {project.data.liveUrl && (
                      <a href={project.data.liveUrl} class="hover:text-primary">
                        ライブデモ →
                      </a>
                    )}
                  </div>
                </article>
              ))
            }
          </div>
          <div class="mt-8">
            <a
              href="/portfolio"
              class="inline-flex items-center text-primary hover:underline"
            >
              すべてのプロジェクトを見る →
            </a>
          </div>
        </div>
      </div>
    </div>
  </section>
</Layout>
